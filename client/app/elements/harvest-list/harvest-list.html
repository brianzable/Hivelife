<dom-module id="harvest-list">
  <template>
    <iron-list id="list" items="[[data]]" as="item" scrollTarget="{{scrollTarget}}">
      <template>
        <a href="{{_harvestUrl(item)}}" style="text-decoration: none; color: inherit;">
          <harvest-list-item>
            <span class="day">{{_dayFromTimestamp(item.harvested_at)}}</span>
            <span class="month">{{_monthFromTimestamp(item.harvested_at)}}</span>
            <span class="notes">{{item.notes}}</span>
            <span class="beekeeper">{{item.last_edit}}</span>
          </harvest-list-item>
        </a>
      </template>
    </iron-list>

    <iron-ajax
      id="client"
      method="get"
      on-response="handleResponse"
      on-error="handleError"></iron-ajax>
  </template>
</dom-module>

<script>
  (function () {
    Polymer({
      is: 'harvest-list',
      behaviors: [HivelifeBehaviors.TimeBehavior],

      properties: {
        hiveId: Number,
        authenticationToken: String,
        scrollTarget: Object
      },

      ready: function () {
        this.data = [];
      },

      loadData: function () {
        var client = this.$.client;

        client.url = 'v1/api/hives/' + this.hiveId + '/harvests';
        client.contentType = 'application/json';
        client.headers = {
          'Authorization': 'Token token=' + this.authenticationToken,
          'Accept': 'application/json'
        };
        client.generateRequest();
      },

      handleResponse: function (event) {
        this.data = event.detail.response;
      },

      handleError: function (event) {
        console.log(event.detail);
      },

      _harvestUrl: function (item) {
        return 'hives/' + this.hiveId + '/harvests/' + item.id;
      },

      _monthFromInspectionDate: function (inspectionDate) {
        var months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        var month = new Date(inspectionDate).getMonth();

        return months[month];
      },

      _dayFromInspectionDate: function (inspectionDate) {
        return new Date(inspectionDate).getDate();
      }
    });
  })();
</script>
