<dom-module id="beekeeper-list">
  <template>
    <iron-list id="list" items="[[data]]" as="item" scrollTarget="{{scrollTarget}}">
      <template>
        <beekeeper-list-item
          apiary-id="{{apiaryId}}"
          beekeeper-id="{{item.id}}"
          editable="{{item.editable}}"
          authentication-token="{{authenticationToken}}">
          <iron-image class="photo" style="height: 60px; width: 60px; border-radius: 50%;" src="{{item.photo_url}}" sizing="cover"></iron-image>
          <span class="name">{{item.name}}</span>
          <span class="role">{{item.role}}</span>
        </beekeeper-list-item>
      </template>
    </iron-list>

    <iron-ajax
      id="client"
      method="get"
      on-response="handleResponse"
      on-error="handleError"></iron-ajax>
  </template>
</dom-module>

<script>
  (function () {
    Polymer({
      is: 'beekeeper-list',

      properties: {
        apiaryId: Number,
        authenticationToken: String,
        scrollTarget: Object
      },

      listeners: {
        'list.beekeeper-delete': '_handleBeekeeperDelete'
      },

      ready: function () {
        this.data = [];
      },

      loadBeekeepers: function () {
        var client = this.$.client;

        client.url = 'v1/api/apiaries/' + this.apiaryId + '/beekeepers';
        client.contentType = 'application/json';
        client.headers = {
          'Authorization': 'Token token=' + this.authenticationToken,
          'Accept': 'application/json'
        };
        client.generateRequest();
      },

      _handleBeekeeperDelete: function (event) {
        console.log(event.detail);
        var result = event.detail.error;
        if (result === false) {
          this.loadBeekeepers();
        }
      },

      handleResponse: function (event) {
        this.data = event.detail.response;
      },

      handleError: function (event) {
        console.log(event.detail);
      },
    });
  })();
</script>
