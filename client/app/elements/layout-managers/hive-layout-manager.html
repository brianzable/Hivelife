<dom-module id="hive-layout-manager">
  <link rel="import" type="css" href="layout-manager-shared.css">

  <template>
    <paper-header-panel main mode="waterfall-tall" class="fit">

      <paper-toolbar id="mainToolbar">
        <a id="backLink" href="{{backLink}}">
          <paper-icon-button id="backButton" icon="arrow-back"></paper-icon-button>
        </a>
        <span class="flex"></span>
        <paper-icon-button icon="more-vert"></paper-icon-button>

        <div class="middle paper-font-display2 app-name">{{name}}</div>

        <div class="bottom">
          <paper-tabs selected="{{selected}}">
            <paper-tab>INSPECTIONS</paper-tab>
            <paper-tab>HARVESTS</paper-tab>
            <paper-tab>MAP</paper-tab>
          </paper-tabs>
        </div>
      </paper-toolbar>

      <div class="content">
        <iron-pages selected="{{selected}}">
          <section>
            <paper-material elevation="1">
              <inspection-list id="inspectionList" authentication-token="{{authenticationToken}}" hive-id="{{hiveId}}"></inspection-list>
            </paper-material>
          </section>

          <section>
            <paper-material elevation="1">
              <harvest-list id="harvestList" authentication-token="{{authenticationToken}}" hive-id="{{hiveId}}"></harvest-list>
            </paper-material>
          </section>

          <section>
            <google-map class="fit"></google-map>
          </section>
        </iron-pages>
      </div>
    </paper-header-panel>

    <iron-ajax
      id="client"
      method="get"
      on-response="handleResponse"
      on-error="handleError"></iron-ajax>
  </template>
</dom-module>

<script>
  (function () {
    Polymer({
      is: 'hive-layout-manager',

      properties: {
        apiaryId: {
          type: Number,
          notify: true,
          observer: '_apiaryIdChanged'
        },
        hiveId: {
          type: Number,
          notify: true,
        },
        selected: {
          type: Number,
          value: 0
        }
      },

      loadHive: function () {
        var client = this.$.client;

        client.url = 'v1/api/apiaries/' + this.apiaryId + '/hives/' + this.hiveId;
        client.contentType = 'application/json';
        client.headers = {
          'Authorization': 'Token token=' + this.authenticationToken,
          'Accept': 'application/json'
        };
        client.generateRequest();

        this.$.inspectionList.loadData();
        this.$.harvestList.loadData();
      },

      handleResponse: function (event) {
        var response = event.detail.response;
        this.name = response.name;
      },

      _apiaryIdChanged: function (newValue, oldValue) {
        this.backLink = 'apiaries/' + newValue;
      }
    });
  })();
</script>
